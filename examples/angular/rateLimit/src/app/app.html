<div style="padding: 20px; max-width: 800px; margin: 0 auto">
  <h1>TanStack Pacer - Rate Limiter Example</h1>

  <section style="margin-bottom: 40px; padding: 20px; border: 1px solid #ddd; border-radius: 8px">
    <h2>Rate Limiter Example</h2>
    <p>
      Rate limiting enforces a hard limit: allows executions until the limit is reached (5 per 5 seconds),
      then blocks all subsequent calls until the window resets. Click the increment button rapidly to see
      the rate limiter in action.
    </p>

    <div style="margin-bottom: 20px">
      <h3>Window Type</h3>
      <div style="display: flex; gap: 20px; margin-bottom: 15px">
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer">
          <input
            type="radio"
            name="windowType"
            value="fixed"
            [checked]="windowType() === 'fixed'"
            (change)="setWindowType('fixed')"
          />
          <span>Fixed Window</span>
        </label>
        <label style="display: flex; align-items: center; gap: 8px; cursor: pointer">
          <input
            type="radio"
            name="windowType"
            value="sliding"
            [checked]="windowType() === 'sliding'"
            (change)="setWindowType('sliding')"
          />
          <span>Sliding Window</span>
        </label>
      </div>
      <p style="color: #666; font-size: 14px">
        <strong>Fixed Window:</strong> Strict window that resets completely after the period.<br />
        <strong>Sliding Window:</strong> Rolling window that allows executions as old ones expire.
      </p>
    </div>

    <div style="margin-bottom: 20px">
      <h3>Rate Limiter Status</h3>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px">
        <div>
          <strong>Execution Count:</strong> {{ rateLimiter.state().executionCount }}
        </div>
        <div>
          <strong>Rejection Count:</strong> {{ rateLimiter.state().rejectionCount }}
        </div>
        <div>
          <strong>Remaining in Window:</strong> {{ rateLimiter.getRemainingInWindow() }} / 5
        </div>
        <div>
          <strong>Ms Until Next Window:</strong> {{ rateLimiter.getMsUntilNextWindow() }}ms
        </div>
      </div>
    </div>

    <div style="margin-bottom: 20px">
      <h3>Counters</h3>
      <div style="display: grid; grid-template-columns: repeat(2, 1fr); gap: 10px; margin-bottom: 15px">
        <div style="padding: 15px; background: #e3f2fd; border-radius: 4px">
          <strong>Instant Count:</strong>
          <div style="font-size: 24px; font-weight: bold; margin-top: 5px">
            {{ instantCount() }}
          </div>
          <div style="font-size: 12px; color: #666; margin-top: 5px">
            Updates immediately on every click
          </div>
        </div>
        <div style="padding: 15px; background: #e8f5e9; border-radius: 4px">
          <strong>Rate Limited Count:</strong>
          <div style="font-size: 24px; font-weight: bold; margin-top: 5px">
            {{ limitedCount() }}
          </div>
          <div style="font-size: 12px; color: #666; margin-top: 5px">
            Only updates when rate limit allows
          </div>
        </div>
      </div>
    </div>

    <div style="margin-bottom: 20px">
      <h3>Controls</h3>
      <div style="display: flex; gap: 10px; margin-bottom: 15px">
        <button
          (click)="increment()"
          style="padding: 12px 24px; border: none; border-radius: 4px; background: #2196f3; color: white; cursor: pointer; font-size: 16px; font-weight: bold"
        >
          Increment
        </button>
        <button
          (click)="reset()"
          style="padding: 12px 24px; border: 1px solid #ddd; border-radius: 4px; background: white; cursor: pointer; font-size: 16px"
        >
          Reset
        </button>
      </div>
      <p style="color: #666; font-size: 14px">
        Click "Increment" rapidly to see the rate limiter block executions after 5 clicks within 5 seconds.
      </p>
    </div>

    <div>
      <h3>Execution History</h3>
      <div style="margin-top: 10px; padding: 10px; background: #f5f5f5; border-radius: 4px; max-height: 300px; overflow-y: auto">
        @if (executionHistory.length === 0) {
          <span style="color: #999">No executions yet. Click "Increment" to start.</span>
        }
        @for (let entry of executionHistory; track $index) {
          <div
            style="margin-bottom: 8px; padding: 8px; background: white; border-radius: 4px; border-left: 4px solid"
            [style.border-left-color]="entry.rejected ? '#f44336' : '#4caf50'"
          >
            <div style="display: flex; justify-content: space-between; align-items: center">
              <div>
                <strong>{{ entry.timestamp }}</strong> - Count: {{ entry.count }}
              </div>
              <span
                style="padding: 4px 8px; border-radius: 4px; font-size: 12px; font-weight: bold"
                [style.background]="entry.rejected ? '#ffebee' : '#e8f5e9'"
                [style.color]="entry.rejected ? '#c62828' : '#2e7d32'"
              >
                {{ entry.rejected ? 'REJECTED' : 'EXECUTED' }}
              </span>
            </div>
          </div>
        }
      </div>
    </div>
  </section>

  <router-outlet />
</div>
