---
id: AsyncBatcher
title: AsyncBatcher
---

<!-- DO NOT EDIT: this page is autogenerated from the type comments -->

# Class: AsyncBatcher\<TValue\>

Defined in: [async-batcher.ts:180](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L180)

A class that collects items and processes them in batches asynchronously.

This is the async version of the Batcher class. Unlike the sync version, this async batcher:
- Handles promises and returns results from batch executions
- Provides error handling with configurable error behavior
- Tracks success, error, and settle counts separately
- Has state tracking for when batches are executing
- Returns the result of the batch function execution

Batching is a technique for grouping multiple operations together to be processed as a single unit.

The AsyncBatcher provides a flexible way to implement async batching with configurable:
- Maximum batch size (number of items per batch)
- Time-based batching (process after X milliseconds)
- Custom batch processing logic via getShouldExecute
- Event callbacks for monitoring batch operations
- Error handling for failed batch operations

Error Handling:
- If an `onError` handler is provided, it will be called with the error and batcher instance
- If `throwOnError` is true (default when no onError handler is provided), the error will be thrown
- If `throwOnError` is false (default when onError handler is provided), the error will be swallowed
- Both onError and throwOnError can be used together - the handler will be called before any error is thrown
- The error state can be checked using the AsyncBatcher instance

State Management:
- Use `initialState` to provide initial state values when creating the async batcher
- Use `onStateChange` callback to react to state changes and implement custom persistence
- The state includes total items processed, success/error counts, and execution status
- State can be retrieved using `getState()` method

## Example

```ts
const batcher = new AsyncBatcher<number>(
  async (items) => {
    const result = await processItems(items);
    console.log('Processing batch:', items);
    return result;
  },
  {
    maxSize: 5,
    wait: 2000,
    onSuccess: (result) => console.log('Batch succeeded:', result),
    onError: (error) => console.error('Batch failed:', error)
  }
);

batcher.addItem(1);
batcher.addItem(2);
// After 2 seconds or when 5 items are added, whichever comes first,
// the batch will be processed and the result will be available
// batcher.execute() // manually trigger a batch
```

## Type Parameters

â€¢ **TValue**

## Constructors

### new AsyncBatcher()

```ts
new AsyncBatcher<TValue>(fn, initialOptions): AsyncBatcher<TValue>
```

Defined in: [async-batcher.ts:187](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L187)

#### Parameters

##### fn

(`items`) => `Promise`\<`any`\>

##### initialOptions

[`AsyncBatcherOptions`](../../interfaces/asyncbatcheroptions.md)\<`TValue`\>

#### Returns

[`AsyncBatcher`](../asyncbatcher.md)\<`TValue`\>

## Properties

### store

```ts
readonly store: Store<AsyncBatcherState<TValue>>;
```

Defined in: [async-batcher.ts:181](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L181)

## Methods

### addItem()

```ts
addItem(item): void
```

Defined in: [async-batcher.ts:228](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L228)

Adds an item to the async batcher
If the batch size is reached, timeout occurs, or shouldProcess returns true, the batch will be processed

#### Parameters

##### item

`TValue`

#### Returns

`void`

***

### clear()

```ts
clear(): void
```

Defined in: [async-batcher.ts:351](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L351)

Removes all items from the async batcher

#### Returns

`void`

***

### flush()

```ts
flush(): void
```

Defined in: [async-batcher.ts:312](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L312)

Processes the current batch of items immediately

#### Returns

`void`

***

### peekAllItems()

```ts
peekAllItems(): TValue[]
```

Defined in: [async-batcher.ts:340](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L340)

Returns a copy of all items in the async batcher

#### Returns

`TValue`[]

***

### peekFailedItems()

```ts
peekFailedItems(): TValue[]
```

Defined in: [async-batcher.ts:344](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L344)

#### Returns

`TValue`[]

***

### reset()

```ts
reset(): void
```

Defined in: [async-batcher.ts:358](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L358)

Resets the async batcher state to its default values

#### Returns

`void`

***

### setOptions()

```ts
setOptions(newOptions): void
```

Defined in: [async-batcher.ts:202](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L202)

Updates the async batcher options

#### Parameters

##### newOptions

`Partial`\<[`AsyncBatcherOptions`](../../interfaces/asyncbatcheroptions.md)\<`TValue`\>\>

#### Returns

`void`

***

### start()

```ts
start(): void
```

Defined in: [async-batcher.ts:330](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L330)

Starts the async batcher and processes any pending items

#### Returns

`void`

***

### stop()

```ts
stop(): void
```

Defined in: [async-batcher.ts:319](https://github.com/TanStack/pacer/blob/main/packages/pacer/src/async-batcher.ts#L319)

Stops the async batcher from processing batches

#### Returns

`void`
